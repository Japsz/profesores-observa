<!-- Esta vista requiere results: results, tags: tags, idteacher: validate(req), show_hidden: false
results: lista de objetos resource
tags es una lista de objetos tags formato [{idresource:tags},...]
idteacher id profesor logeado, o false.
show_hidden: permite mostrar recursos bloqueados.

-->

<div class="row">
    <div class="col-xs-12 col-sm-12">
        <!-- Corresponde a una contribuci칩n -->
        <section class="blog-post">
            <div class="panel panel-default">
                <%if (frontimage){ %>
                    <div style="padding: 2%">
                        <img src="/uploaded-files/<%=idteacher%>/<%=idresource%>/<%=frontimage%>" class="img-responsive" style="border: 2px solid black; width: 100%"/>
                    </div>
                <%}%>

                <div class="row">
                    <div class="col-sm-1">
                        <img src="/icons/RRCC web-07.png" class="img-rounded" style="width: 60px">
                    </div>
                    <div class="col-sm-10" style="margin-left: 10px">
                        <h2 class="blog-post-title" style="font-weight: 500; margin-top: 10px">
                            <%=title%>
                            <p class="bs-component btn-group-sm pull-right">
                                <%if(idteacher == logged){%>
                                    <a onclick="edit_modal(<%=idresource%>)" class="btn btn-warning btn-fab"><i class="material-icons">edit</i></a>
                                    <%if(state != 'Activo'){%>
                                        <a onclick="activate(<%=idresource%>)" class="btn btn-success btn-fab"><i class="material-icons">lock_open</i></a>
                                    <%} else {%>
                                        <a onclick="deactivate(<%=idresource%>)" class="btn btn-danger btn-fab"><i class="material-icons">lock</i></a>
                                    <%}
                                }%>
                            </p>
                        </h2>
                        <div class="blog-post-meta" style="padding: 0;">
                            <h4>por <%=name%> - <%=date.slice(0, date.indexOf('T'))%></h4>
                        </div>
                        <!-- Barra -->

                        <!-- Ac치 va el contenido de la contribuci칩n (s칩lo vista previa) -->
                        <p><%=description%></p>
                        <p><%=text%></p>
                    </div>

                    <div class="col-sm-3 col-sm-offset-6" style="padding: 0">
                        <!-- El param del onclick debe ser el idresource -->
                    </div>

                    <div class="col-sm-3" style="padding-right: 0; padding-left: 3px">
                        <img src="/icons/RRCC web-24.png" class="img-rounded" style="width: 20px; display: inline;">
                        <img src="/icons/RRCC web-24.png" class="img-rounded" style="width: 20px; display: inline;">
                        <img src="/icons/RRCC web-25.png" class="img-rounded" style="width: 20px; display: inline;">
                        <img src="/icons/RRCC web-25.png" class="img-rounded" style="width: 20px; display: inline;">
                        <img src="/icons/RRCC web-25.png" class="img-rounded" style="width: 20px; display: inline;">
                    </div>
                </div>

                <!-- Aca van las descargas-->
                <div class="row resource-row">
                    <%for(file in files){%>
                        <div class="col-xs-4 col sm-4">
                            <div class="panel panel-primary">
                                <div class="panel-heading resource-head">
                                    <h5><%=files[file].filename%></h5>
                                    </div>
                                <div class="panel-body">
                                    <a class="btn btn-primary" href="resource/download/<%=idteacher%>/<%=idresource%>/<%=files[file].filename%>>" style="float: left">Descargar</a>
                                </div>
                            </div>
                        </div>
                    <%}%>
                </div>
            </div>
            <%if (idteacher == logged) {
                var modal_data = {
                    idresource: idresource,
                    idteacher: idteacher,
                    title: title,
                    description: description,
                    tags: tags[idresource]
                };
            %>
            <%- include('./modal/edit_resource.ejs', modal_data); %>
            <%}%>
        </section>
        <div id="view_comment">
            <!-- Aca va insertar comentario y los comentarios existentes del recurso. -->
        </div>
    </div>
</div>

<%- include modal/edit_resource.ejs %>

<script type="text/javascript">
    $(document).ready(function(){
        $.ajax({
            type: 'GET',
            url: '/comment/view_comment/'+<%=idresource%>,
            success: function (html) {
                $('#view_comment').append(html);
            }
        });
    });

    function download(idteacher, idresource, filename) {
        console.log(idteacher, idresource, filename);
        $.ajax({
            type: 'POST',
            data: {
                idteacher: idteacher,
                idresource: idresource,
                filename: filename},
            url: '/resource/download',
            success: function (html) {
            }
        })

    }

    function edit_resource(idresource) {
        $('#modal_edit_resource').modal('toggle');
    }
</script>