<!-- Esta vista requiere results: results, tags: tags, idteacher: validate(req), show_hidden: false
results: lista de objetos resource
tags es una lista de objetos tags formato [{idresource:tags},...]
idteacher id profesor logeado, o false.
show_hidden: permite mostrar recursos bloqueados.

-->

<div class="row">
    <div class="col-xs-12 col-sm-12">
        <section>
            <div class="row">
                <div style="margin: 1.6%">
                    <div class="col-sm-12" style="border-bottom: 2px gray solid; padding: 0; padding-bottom: 3px; margin-bottom: 5px">
                        <h4 style="display: inline-block; margin: 0">Estas en el recurso/<%=title%></h4>
                        <div class="pull-right" style="display: inline-block;">
                            <a class="btn btn_obs" href="/teacher" style="">Volver a Inicio</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <br><br>
        <!-- Corresponde a un recurso -->
        <section class="blog-post">
            <div class="panel panel-default" style="padding: 10px">
                <div class="row">
                    <div class="col-sm-1">
                        <img src="/icons/RRCC web-07.png" class="img-rounded" style="width: 60px">
                    </div>
                    <div class="col-sm-10" style="margin-left: 10px">
                        <h2 class="blog-post-title" style="font-weight: 500; margin-top: 10px">
                            <%=title%>
                            <p class="bs-component btn-group-sm pull-right">
                                <%if(idteacher == logged){%>
                                    <a onclick="edit_modal(<%=idresource%>)" class="btn btn-warning btn-fab"><i class="material-icons">edit</i></a>
                                    <%if(state != 'Activo'){%>
                                        <a onclick="activate(<%=idresource%>)" class="btn btn-success btn-fab"><i class="material-icons">lock_open</i></a>
                                    <%} else {%>
                                        <a onclick="deactivate(<%=idresource%>)" class="btn btn-danger btn-fab"><i class="material-icons">lock</i></a>
                                    <%}
                                } %>
                            </p>
                            <div id="scores<%=idresource%>" class="pull-right" style="padding-right: 0; padding-left: 3px; padding-top: 5px; padding-right: 4px">
                                <% for(let i = 1; i <= 5 ; i++){
                                    if (scores[idresource] >= i){ %>
                                    <input id="score" type="image" onclick="score('<%=i%>','<%=idresource%>','<%=idteacher%>')"
                                       src="/icons/RRCC web-24.png" class="img-rounded" style="width: 20px; display: inline;">
                                    <%} else {%>
                                    <input id="score" type="image" onclick="score('<%=i%>','<%=idresource%>','<%=idteacher%>')"
                                       src="/icons/RRCC web-25.png" class="img-rounded" style="width: 20px; display: inline;">
                                    <%}
                                }%>
                            </div>
                        </h2>
                        <div class="blog-post-meta" style="padding: 0;">
                            <h4>por <%=name%> - <%=date.slice(0, date.indexOf('T'))%></h4>

                        </div>

                        <div class="row">
                            <!-- DESCRIPCION -->
                            <p><%=description%></p>
                            <!-- IMAGEN -->
                            <div style="padding: 2%; float:right;">
                                <%if(frontimage){%>
                                    <img src="/uploaded-files/<%=idteacher%>/<%=idresource%>/<%=frontimage%>" class="img-responsive" style="border: 2px solid black; width: 350px; float: right">
                                <%}%>
                            </div>
                            <p><%=text%></p>
                        </div>

                        <div class="row">
                            <div class="col-sm-1" style="display: inline;"><img src="/icons/RRCC web-21.png" style="width: 40px; font-size: 5px"></div>
                            <div id="tagtype<%=idresource%>" class="col-sm-3" style="margin-top: 3px; padding: 0px"></div>
                            <div class="col-sm-1" style="display: inline;"><img src="/icons/RRCC web-22.png" style="width: 40px"></div>
                            <div id="tagarea<%=idresource%>" class="col-sm-3" style="margin-top: 3px; padding: 0px"></div>
                            <div class="col-sm-1" style="display: inline;"><img src="/icons/RRCC web-23.png" style="width: 40px"></div>
                            <div id="tagfile<%=idresource%>" class="col-sm-3" style="margin-top: 3px; padding: 0px"></div>
                        </div>
                        <script>
                            <%
                            if(tags[idresource].length > 0){
                                tags[idresource].forEach(function (tag) {
                                    console.log(tag);
                                    if (tag[1] == 'type'){%>
                                        $('#tagtype<%=idresource%>').append('<%=tag[0]%>.<br>');
                                    <%}
                                    if (tag[1] == 'area'){%>
                                        $('#tagarea<%=idresource%>').append('<%=tag[0]%>.<br>');
                                    <%}
                                    if (tag[1] == 'file'){%>
                                        $('#tagfile<%=idresource%>').append('<%=tag[0]%>.<br>');
                                    <%}
                                });
                            }%>

                        </script>

                        <!-- Aca comienza contenido descargas -->
                        <div class="row" style="border-bottom: 2px orange solid; padding-bottom: 3px; margin-bottom: 5px">
                            <img src="/icons/RRCC web-23.png" style="width: 50px; margin: 0px; float: left">
                            <h3 style="margin: 0px">Archivos Adjuntos</h3>
                            Aca estan los archivos que se asocian a este recurso.
                        </div>
                        <div class="row resource-row" style="margin-top: 10px">
                            <%
                            if(files.length > 0){
                                for(file in files){%>
                                    <div class="col-sm-3" style="margin-bottom: 5px; text-align: center;">
                                        <p class="text-center">
                                            <a class="btn" href="resource/download/<%=idteacher%>/<%=idresource%>/<%=files[file].filename%>" style="white-space: normal" >
                                                <img src="/icons/RRCC web_<%=files[file].ext%>.png" onerror="this.src='/icons/RRCC web_file.png'" style="width: 100px">
                                                <h5 style=""><%=files[file].filename%></h5>
                                            </a>
                                        </p>
                                    </div>
                            <%}
                            } else {%>
                                <br>
                                <h3 style="text-align: center;">Este recurso no tiene archivos.</h3>
                                <br>
                            <%}%>
                        </div>

                        <!-- Aca comienza contenido revisiones -->
                        <div class="row" style="border-bottom: 2px deeppink solid; padding-bottom: 3px; margin-bottom: 8px">
                            <img src="/icons/RRCC web-22.png" style="width: 50px; margin: 0px; float: left">
                            <h3 style="margin: 0px">Revisiones</h3>
                            Recursos compartidos por otros usuarios/as, que se relacionan con este.
                        </div>
                        <div class="row resource-row" >
                            <%
                            if(reviews.length > 0){
                                for(review in reviews){%>
                                    <a onclick="show_a_resource(<%=reviews[review].idresource%>)" style="cursor: pointer">
                                        <h3 style="display: inline"><img src="/icons/RRCC web-07.png" style="width: 35px"><%=reviews[review].title%> por <%=reviews[review].name%>
                                            <h4 style="display: inline"><%=reviews[review].date.slice(0, date.indexOf('T'))%></h4>
                                        </h3>
                                    </a>
                            <%}
                            } else {%>
                                <br>
                                <h3 style="text-align: center;">Este recurso no tiene Revisiones.</h3>
                                <br>
                            <%}%>
                            <a onclick="new_review(<%=idresource%>)" class="btn"><i class="material-icons">assignment</i>Contribuye con una revision </a>
                        </div>

                    </div>
                </div>

                <!-- Aca van las descargas-->
            </div>
            <%if (idteacher == logged) {
                var modal_data = {
                    idresource: idresource,
                    idteacher: idteacher,
                    title: title,
                    description: description,
                    tags: tags[idresource]
                };
            %>
            <%- include('./modal/edit_resource.ejs', modal_data); %>
            <%}%>
        </section>
        <div id="view_comment">
            <!-- Aca va insertar comentario y los comentarios existentes del recurso. -->
        </div>
    </div>
</div>

<%- include modal/edit_resource.ejs %>

<style type="text/css">
    .btn_obs{

    }
</style>

<script type="text/javascript">
    $(document).ready(function(){
        $.ajax({
            type: 'POST',
            data: {idresource: <%=idresource%>, idteacher: <%=idteacher%>},
            url: '/comment/view_comment/',
            success: function (html) {
                $('#view_comment').append(html);
            }
        });
    });

    function edit_modal(idresource) {
        $('#modal_edit_resource').modal('toggle');
    }

    function new_review(idresource) {
        $('#modal_new_resource').modal('toggle');
        $('#idresourcedad').attr('value', idresource);
    }

    function score(score, idresource, idteacher) {
        $.ajax({
            type: 'POST',
            url: '/resource/score',
            data: {
                score: score,
                idresource: idresource,
                idteacher: idteacher
            },
            success: function (html) {
                show_a_resource(idresource);
            }
        });
    }
</script>